<html>

<style>
th, td, input {
    font-size: 25px;
}

td {
    text-align: center;
}

</style>

<script>
    // Greatest common denominator. Both inputs should be positive integers.
    function gcd2(a, b) {
        var smallest = Math.min(a, b);

        for (var i = 2; i <= smallest; i++) {
            if ((a % i == 0) && (b % i == 0)) {
                return i * gcd2(a / i, b / i);
            }
        }

        return 1;
    }

    // Least common multiple. Both inputs should be positive integers.
    function lcm2(a, b) {
        return (a * b) / gcd2(a, b);
    }

    // Least common multiple of a list of positive integers.
    function lcm(l) {
        var out = l[0];

        for (var i = 1; i < l.length; i++) {
            out = lcm2(out, l[i]);
        }

        return out;
    }

    // Get a new entry, i.e. a dict of keys and values that define a user input
    function newEntry(num=4, bActive=true) {
        return {
            'bActive': bActive, // Should this entry be used in computations?
            'num': num, // Time signature numerator
            'den': 4, // Time signature denominator
            'bars': bActive ? '1' : '-', // Full bars until this time signature syncs with others
        }
    }

    // Update the values for all entries in gEntries
    function updateEntries() {
        var nums = []

        for (var idx = 0; idx < gEntries.length; idx++) {
            var e = gEntries[idx];

            e['bActive']  = document.getElementById('bActive_' + idx).checked;
            e['num'] = document.getElementById('num_' + idx).value;

            if (e['bActive']) {
                nums.push(e['num']);
            }
            else {
                e['bars'] = '-';
            }
        }

        var nBeats = lcm(nums);

        for (e of gEntries) {
            if (!e['bActive']) {
                continue;
            }
            e['bars'] = nBeats / e['num'];
        }
    }

    function updatedTableHtml() {
        var s = '<table border="1"><tr><tr><th>&nbsp;Active&nbsp;</th><th>&nbsp;Time Signature&nbsp;</th><th>&nbsp;Bars Until Sync&nbsp;</th><th>&nbsp;Explanation&nbsp;</th></tr>';

        var idx = 0;
        for (var idx = 0; idx < gEntries.length; idx++) {
            var e = gEntries[idx];

            s += '<tr>';

            s += '<td><input type="checkbox" id="bActive_' + idx + '" onchange="updateTable()"';
            if (e['bActive']) {
                s += ' checked';
            }
            s += '></input></td>';

            s += '<td><input type="number" step="1" min="1" id="num_' + idx + '" value="' + e["num"] + '" style="width: 4ch" onchange="updateTable()">';
            s += ' / ' + e['den'] + '</td>';

            s += '<td>' + e['bars'] + '</td>';

            var explanation = '-'
            if (e['bActive']){
                var beats = e['bars'] * e['num'];
                explanation = 'The time signatures sync after ' + beats + ' beats, which is ' + e['bars'] + ' bars of ' + e['num'] + '/4.';
            }

            s += '<td>' + explanation + '</td>';

            s += '</tr>';
        }
        s += '</table>';

        return s;
    }

    var gEntries = [newEntry(3), newEntry(4), newEntry(5, false), newEntry(7, false)];

    function updateTable() {
        updateEntries();
        displayTable();
    }

    function displayTable() {
        var t = document.getElementById('tableDiv');
        t.innerHTML = updatedTableHtml();
    }

    function init() {
        // First "display" the table to create it, then run the update routine
        displayTable();
        updateTable();
    }

    window.onload = init;
</script>

<body>
    <p>This page let's you enter multiple time signatures and see how long it'll take for them to sync up.</p>
    <div id='tableDiv'></div>
</body>

</html>
